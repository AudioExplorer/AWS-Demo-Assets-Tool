#!/bin/bash
# Auto-load NVM if available
export NVM_DIR="$HOME/.nvm"
if [ -s "$NVM_DIR/nvm.sh" ]; then
  . "$NVM_DIR/nvm.sh"
fi

# Use current or default Node
NODE_PATH=$(npm root -g 2>/dev/null)

# Locate the latest create-demo-assets.mjs script dynamically
SCRIPT_PATH=$(find "$HOME/Documents/projects" -type f -name "create-demo-assets.mjs" 2>/dev/null | head -n 1)

if [ -z "$SCRIPT_PATH" ]; then
  echo "❌ Could not find create-demo-assets.mjs in ~/Documents/projects"
  exit 1
fi

echo "🪄 Using Node from: $(which node)"
echo "📁 Running: $SCRIPT_PATH"

# Ensure NODE_PATH includes global modules
export NODE_PATH="$NODE_PATH:$(npm root -g 2>/dev/null)"
export NODE_OPTIONS="--experimental-specifier-resolution=node"

exec node "$SCRIPT_PATH" "$@"
